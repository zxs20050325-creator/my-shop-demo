<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- =========================
         é¡µé¢åŸºç¡€é…ç½®
         ========================= -->

    <!-- UTF-8 ç¼–ç ï¼Œé˜²æ­¢ä¸­æ–‡ä¹±ç  -->
    <meta charset="UTF-8">

    <!--
        viewport ç”¨äºç§»åŠ¨ç«¯é€‚é…
        width=device-width  = é¡µé¢å®½åº¦ç­‰äºè®¾å¤‡å®½åº¦
        initial-scale=1.0   = åˆå§‹ç¼©æ”¾æ¯”ä¾‹
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- æµè§ˆå™¨æ ‡ç­¾é¡µæ˜¾ç¤ºçš„æ ‡é¢˜ -->
    <title>å†€é—ç­‘æ¢¦äº‘ç«¯ç›²ç›’å•†åŸâ€”â€”â€”â€”å®æ—¶æ•°æ®å˜åŒ–å¹³å°</title>

    <!--
        Chart.js å›¾è¡¨åº“ï¼ˆCDN å¼•å…¥ï¼‰
        ä½œç”¨ï¼šè´Ÿè´£æ‰€æœ‰æŠ˜çº¿å›¾ / é¥¼å›¾ / æŸ±çŠ¶å›¾æ¸²æŸ“
        ä¼˜ç‚¹ï¼šè½»é‡ã€æˆç†Ÿã€é€‚åˆåå°æ•°æ®å¯è§†åŒ–
    -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* =====================================================
           ä¸€ã€CSS å…¨å±€ä¸»é¢˜å˜é‡ï¼ˆç»Ÿä¸€é£æ ¼ï¼Œæ–¹ä¾¿ç»´æŠ¤ï¼‰
           ===================================================== */

        /*
            :root è¡¨ç¤º HTML æ ¹èŠ‚ç‚¹
            åœ¨è¿™é‡Œå®šä¹‰ CSS å˜é‡ï¼Œæ•´ä¸ªé¡µé¢éƒ½å¯ä»¥ä½¿ç”¨
            åæœŸå¦‚æœæƒ³æ¢ä¸»é¢˜é¢œè‰²ï¼Œåªæ”¹è¿™é‡Œå³å¯
        */
        :root {
            --bg-color: #0b1120;       /* æ•´ä¸ªé¡µé¢çš„èƒŒæ™¯è‰²ï¼ˆæ·±è‰²ç§‘æŠ€é£ï¼‰ */
            --card-bg: #151e32;        /* æ‰€æœ‰å¡ç‰‡/æ¨¡å—çš„èƒŒæ™¯è‰² */
            --text-primary: #f8fafc;   /* ä¸»æ–‡å­—é¢œè‰²ï¼ˆç™½åè“ï¼‰ */
            --text-secondary: #94a3b8; /* æ¬¡çº§æ–‡å­—é¢œè‰²ï¼ˆç°ï¼‰ */

            /* åŠŸèƒ½å¼ºè°ƒè‰²ï¼ˆç”¨äº KPI / å›¾è¡¨ / çŠ¶æ€ï¼‰ */
            --accent-blue: #3b82f6;
            --accent-purple: #8b5cf6;
            --accent-green: #10b981;
            --accent-gold: #f59e0b;
        }

        /* =====================================================
           äºŒã€CSS Reset + å…¨å±€å­—ä½“
           ===================================================== */

        /*
            * é€‰æ‹©å™¨è¡¨ç¤ºåŒ¹é…æ‰€æœ‰å…ƒç´ 
            ä½œç”¨ï¼š
            1. æ¸…é™¤æµè§ˆå™¨é»˜è®¤ margin / padding
            2. ç»Ÿä¸€ç›’æ¨¡å‹
            3. ç»Ÿä¸€å­—ä½“
        */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box; /* padding ä¸å†æ’‘å¤§å…ƒç´  */
            font-family: 'Segoe UI', sans-serif;
        }

        /* =====================================================
           ä¸‰ã€é¡µé¢æ•´ä½“æ ·å¼
           ===================================================== */

        body {
            background-color: var(--bg-color); /* ä½¿ç”¨ä¸»é¢˜èƒŒæ™¯è‰² */
            color: var(--text-primary);        /* é»˜è®¤æ–‡å­—é¢œè‰² */
            padding: 20px;                     /* é¡µé¢è¾¹è· */
        }

        /* =====================================================
           å››ã€ä»ªè¡¨ç›˜æ•´ä½“å¸ƒå±€ï¼ˆCSS Gridï¼‰
           ===================================================== */

        /*
            dashboard-container æ˜¯æ•´ä¸ªåå°çš„â€œéª¨æ¶â€
            ä½¿ç”¨ grid å®ç°ç±»ä¼¼å¤§å± / BI çœ‹æ¿å¸ƒå±€
        */
        .dashboard-container {
            max-width: 1400px;     /* é˜²æ­¢è¶…å®½å±æ‹‰å¾—å¤ªæ•£ */
            margin: 0 auto;        /* å±…ä¸­æ˜¾ç¤º */

            display: grid;

            /*
                å®šä¹‰ 4 åˆ—ç­‰å®½ç½‘æ ¼
                é€‚åˆ KPI å¡ç‰‡æ¨ªå‘æ’åˆ—
            */
            grid-template-columns: repeat(4, 1fr);

            /*
                è¡Œé«˜è‡ªé€‚åº”
                åç»­å›¾è¡¨ã€è¡¨æ ¼ä¼šè‡ªåŠ¨æ’‘å¼€
            */
            grid-template-rows: auto auto auto;

            gap: 20px; /* ç½‘æ ¼é—´è· */
        }

        /* =====================================================
           äº”ã€é¡¶éƒ¨ Headerï¼ˆæ ‡é¢˜ + ç³»ç»ŸçŠ¶æ€ï¼‰
           ===================================================== */

        .header {
            grid-column: 1 / -1;  /* æ¨ªè·¨æ•´è¡Œï¼ˆä»ç¬¬ 1 åˆ—åˆ°æœ€åä¸€åˆ—ï¼‰ */

            display: flex;
            justify-content: space-between; /* å·¦å³åˆ†å¸ƒ */
            align-items: center;

            border-bottom: 1px solid #334155;
            padding-bottom: 15px;
        }

        /* ä¸»æ ‡é¢˜ï¼ˆæ¸å˜æ–‡å­—ï¼‰ */
        .header h1 {
            font-size: 26px;
            font-weight: 800;

            /*
                æ¸å˜æ–‡å­—å®ç°æ–¹å¼ï¼š
                1. èƒŒæ™¯è®¾ä¸ºæ¸å˜
                2. background-clip è£å‰ªåˆ°æ–‡å­—
                3. æ–‡å­—é¢œè‰²è®¾ä¸ºé€æ˜
            */
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            color: transparent;
        }

        /* å³ä¸Šè§’ç³»ç»ŸçŠ¶æ€ */
        .status {
            font-size: 14px;
            color: var(--accent-green);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* å‘¼å¸ç¯å°åœ†ç‚¹ */
        .dot {
            width: 8px;
            height: 8px;
            background: var(--accent-green);
            border-radius: 50%;

            /*
                animation:
                åç§°   æ—¶é•¿  å¾ªç¯æ–¹å¼
            */
            animation: pulse 2s infinite;
        }

        /* å‘¼å¸åŠ¨ç”»å®šä¹‰ */
        @keyframes pulse {
            0%   { opacity: 1; }
            50%  { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* =====================================================
           å…­ã€KPI æ•°æ®å¡ç‰‡
           ===================================================== */

        /*
            KPI å¡ç‰‡ç”¨äºå±•ç¤ºï¼š
            - æ€»é”€å”®é¢
            - æ€»è®¿é—®é‡
            - è®¢å•æ•°
            - æ´»è·ƒç”¨æˆ·
        */
        .kpi-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;

            /*
                å·¦ä¾§å½©è‰²è¾¹æ¡
                ç”¨äºåŒºåˆ†ä¸åŒæŒ‡æ ‡ç±»å‹
            */
            border-left: 5px solid var(--accent-blue);

            height: 140px;

            display: flex;
            flex-direction: column;
            justify-content: space-between;

            transition: transform 0.3s;
        }

        /* é¼ æ ‡æ‚¬åœæµ®èµ·æ•ˆæœ */
        .kpi-card:hover {
            transform: translateY(-5px);
        }

        .kpi-title {
            font-size: 13px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .kpi-value {
            font-size: 36px;
            font-weight: bold;
        }

        .kpi-sub {
            font-size: 12px;
            color: var(--accent-green);
        }

        /* =====================================================
           ä¸ƒã€å›¾è¡¨å®¹å™¨
           ===================================================== */

        /*
            chart-container æ˜¯æ‰€æœ‰å›¾è¡¨çš„ç»Ÿä¸€å¤–å£³
            ä¿è¯æ ·å¼ä¸€è‡´
        */
        .chart-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            position: relative;
        }

        /*
            ä¸»æµé‡å›¾ï¼šå  2 åˆ—
            ä¾§è¾¹é¥¼å›¾ & æ¡å½¢å›¾ï¼šå„å  1 åˆ—
        */
        .chart-main { grid-column: 1 / 3; height: 380px; }
        .chart-side { grid-column: 3 / 4; height: 380px; }
        .chart-bar  { grid-column: 4 / 5; height: 380px; }

        /* =====================================================
           å…«ã€æ—¥å¿—è¡¨æ ¼
           ===================================================== */

        table {
            width: 100%;
            border-collapse: collapse; /* åˆå¹¶è¾¹æ¡† */
            margin-top: 15px;
        }

        th {
            text-align: left;
            color: var(--text-secondary);
            font-size: 13px;
            padding: 15px;
            border-bottom: 1px solid #334155;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #334155;
            font-size: 14px;
        }

        tr:hover {
            background: #1e293b;
        }

        /* è¡Œä¸ºç±»å‹æ ‡ç­¾ï¼ˆå¾½ç« ï¼‰ */
        .badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        /* ä¸åŒè¡Œä¸ºå¯¹åº”ä¸åŒé¢œè‰² */
        .bg-pay  { background: rgba(16,185,129,.2); color: #34d399; }
        .bg-cart { background: rgba(245,158,11,.2); color: #fbbf24; }
        .bg-view { background: rgba(59,130,246,.2); color: #60a5fa; }
    </style>
</head>

<body>

<!-- =====================================================
     é¡µé¢ä¸»ä½“ç»“æ„ï¼ˆHTMLï¼‰
     ===================================================== -->

<div class="dashboard-container">

    <!-- é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ -->
    <div class="header">
        <h1>ğŸ›ï¸ å†€é—ç­‘æ¢¦ | æ•°æ®ç›‘æ§ä¸­å¿ƒ</h1>

        <!-- ç³»ç»ŸçŠ¶æ€æ˜¾ç¤º -->
        <div class="status">
            <div class="dot"></div>
            System Online (Beijing Time)
        </div>
    </div>

    <!-- KPIï¼šæ€»é”€å”®é¢ -->
    <div class="kpi-card" style="border-left-color: var(--accent-gold);">
        <div class="kpi-title">æ€»é”€å”®é¢</div>
        <!-- JS ä¼šåŠ¨æ€ä¿®æ”¹è¿™ä¸ªå€¼ -->
        <div class="kpi-value" id="kpi-revenue">Â¥0</div>
        <div class="kpi-sub">â†‘ å®æ—¶æ›´æ–°</div>
    </div>

    <!-- KPIï¼šæ€»è®¿é—®é‡ -->
    <div class="kpi-card">
        <div class="kpi-title">æ€»è®¿é—®é‡</div>
        <div class="kpi-value" id="kpi-visits">0</div>
        <div class="kpi-sub">å…¨å¹³å°ç»Ÿè®¡</div>
    </div>

    <!-- KPIï¼šè®¢å•æ•° -->
    <div class="kpi-card">
        <div class="kpi-title">æˆäº¤è®¢å•</div>
        <div class="kpi-value" id="kpi-orders">0</div>
        <div class="kpi-sub">è½¬åŒ–ç‡ç›‘æ§</div>
    </div>

    <!-- KPIï¼šæ´»è·ƒç”¨æˆ· -->
    <div class="kpi-card">
        <div class="kpi-title">æ´»è·ƒç”¨æˆ·</div>
        <div class="kpi-value" id="kpi-users">0</div>
        <div class="kpi-sub">åœ¨çº¿ä¼°ç®—</div>
    </div>

    <!-- å›¾è¡¨ï¼š24 å°æ—¶æµé‡ -->
    <div class="chart-container chart-main">
        <canvas id="trafficChart"></canvas>
    </div>

    <!-- å›¾è¡¨ï¼šç”¨æˆ·è¡Œä¸º -->
    <div class="chart-container chart-side">
        <canvas id="actionChart"></canvas>
    </div>

    <!-- å›¾è¡¨ï¼šçƒ­é—¨å•†å“ -->
    <div class="chart-container chart-bar">
        <canvas id="productChart"></canvas>
    </div>

    <!-- å®æ—¶æ—¥å¿—è¡¨æ ¼ -->
    <div class="table-section">
        <table>
            <tbody id="log-table-body"></tbody>
        </table>
    </div>

</div>

<script>
/* =====================================================
   ä¹ã€JavaScript é€»è¾‘
   ===================================================== */

/*
    Chart.js å…¨å±€é»˜è®¤é…ç½®
    ç»Ÿä¸€å›¾è¡¨å­—ä½“é¢œè‰²å’Œè¾¹æ¡†é¢œè‰²
*/
Chart.defaults.color = '#94a3b8';
Chart.defaults.borderColor = '#334155';

/*
    ä¿å­˜å›¾è¡¨å®ä¾‹çš„å˜é‡
    æ–¹ä¾¿åç»­æ›´æ–°æ•°æ®
*/
let trafficChart, actionChart, productChart;

/* =====================================================
   åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
   ===================================================== */
function initCharts() {

    /* ---------- æµé‡æŠ˜çº¿å›¾ ---------- */
    const ctx1 = document.getElementById('trafficChart').getContext('2d');

    trafficChart = new Chart(ctx1, {
        type: 'line',
        data: {
            /* X è½´ï¼š24 å°æ—¶ */
            labels: Array.from({ length: 24 }, (_, i) => `${i}:00`),

            /* æ•°æ®é›† */
            datasets: [{
                label: 'è®¿é—®é‡',
                data: Array(24).fill(0), /* åˆå§‹å€¼å…¨ä¸º 0 */
                borderColor: '#3b82f6',
                fill: true,
                tension: 0.4 /* æ›²çº¿å¹³æ»‘ */
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
}

/* =====================================================
   ä»åå°æ‹‰æ•°æ®å¹¶æ›´æ–°ç•Œé¢
   ===================================================== */
async function updateDashboard() {
    try {
        /*
            è¯·æ±‚åå°æ¥å£
            æ¥å£åº”è¯¥è¿”å›ï¼š
            {
              kpi: { revenue, visits, orders, activeUsers },
              charts: { ... },
              logs: [...]
            }
        */
        const res = await fetch('/api/admin/stats');
        const data = await res.json();

        /* æ›´æ–° KPI æ–‡æœ¬ */
        document.getElementById('kpi-revenue').innerText = `Â¥${data.kpi.revenue}`;
        document.getElementById('kpi-visits').innerText  = data.kpi.visits;
        document.getElementById('kpi-orders').innerText  = data.kpi.orders;
        document.getElementById('kpi-users').innerText   = data.kpi.activeUsers;

    } catch (err) {
        console.error('æ•°æ®æ›´æ–°å¤±è´¥', err);
    }
}

/* =====================================================
   é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
   ===================================================== */
window.onload = () => {
    initCharts();          // åˆå§‹åŒ–å›¾è¡¨
    updateDashboard();     // æ‹‰å–ä¸€æ¬¡æ•°æ®
    setInterval(updateDashboard, 3000); // æ¯ 3 ç§’åˆ·æ–°
};
</script>

</body>
</html>
