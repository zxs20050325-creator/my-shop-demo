<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>冀遗筑梦 | 数字化非遗盲盒平台</title>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        /* ========================================
           0. 设计系统
           ======================================== */
        :root {
            --c-primary: #2F4842;    /* 青黛 */
            --c-accent: #C1A268;     /* 鎏金 */
            --c-bg: #F2F0EB;         /* 宣纸灰 */
            --c-grid: #E0DED9;       /* 网格线 */
            --c-danger: #B22222;     /* 朱砂红 */
            --f-serif: 'Noto Serif SC', 'Songti SC', serif;
            --f-mono: 'Courier New', monospace;
            --sidebar-width: 100px;
        }

        /* [1. 墨金光标] */
        body { cursor: none !important; }
        a, button, .dynasty-mark, .product-card, i { cursor: none !important; }
        #cursor-ink { width: 10px; height: 10px; background: var(--c-primary); position: fixed; pointer-events: none; border-radius: 50%; z-index: 10001; }
        #cursor-wash { width: 35px; height: 35px; border: 1px solid rgba(193, 162, 104, 0.4); position: fixed; pointer-events: none; border-radius: 50%; z-index: 10000; transition: width 0.3s, height 0.3s, background 0.3s; mix-blend-mode: multiply; }
        .ink-active { width: 60px !important; height: 60px !important; background: radial-gradient(circle, rgba(193, 162, 104, 0.2) 0%, transparent 80%) !important; }

        /* 基础布局 */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: var(--c-bg); color: var(--c-primary); font-family: var(--f-serif); overflow-x: hidden; background-image: linear-gradient(var(--c-grid) 1px, transparent 1px), linear-gradient(90deg, var(--c-grid) 1px, transparent 1px); background-size: 40px 40px; }

        /* [4. 侧边栏社交图标交互] */
        .sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: var(--sidebar-width); background: #fff; border-right: 2px solid var(--c-primary); display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: 40px 0; z-index: 1000; }
        .brand-plaque { background: var(--c-primary); color: #fff; padding: 25px 12px; border-radius: 4px; box-shadow: 4px 4px 0 var(--c-accent); position: relative; }
        .brand-vertical { writing-mode: vertical-rl; font-size: 22px; font-weight: 900; letter-spacing: 6px; }
        .social-links { display: flex; flex-direction: column; gap: 25px; align-items: center; }
        .social-links i { font-size: 24px; color: var(--c-primary); opacity: 0.6; transition: 0.3s ease; }
        .social-links i:hover { opacity: 1; color: var(--c-accent); transform: translateY(-5px); }

        /* [5. 顶部导航与购物车重组] */
        .top-bar { grid-area: top-bar; padding: 25px 60px; display: flex; justify-content: flex-end; align-items: center; gap: 30px; position: sticky; top: 0; z-index: 900; background: rgba(242, 240, 235, 0.8); backdrop-filter: blur(10px); }
        .search-box { display: flex; align-items: center; border-bottom: 1.5px solid var(--c-primary); padding: 5px; }
        .search-box input { background: none; border: none; outline: none; width: 180px; font-family: var(--f-serif); }
        
        .header-actions { display: flex; align-items: center; gap: 20px; font-family: var(--f-mono); font-size: 13px; }
        .cart-link { display: flex; align-items: center; gap: 8px; padding: 6px 15px; border: 1.5px solid var(--c-primary); border-radius: 20px; transition: 0.3s; text-decoration: none; color: inherit; }
        .cart-link:hover { background: var(--c-primary); color: #fff; }
        .cart-count-header { background: var(--c-danger); color: #fff; padding: 1px 6px; border-radius: 10px; font-size: 11px; }

        .main-wrapper { margin-left: var(--sidebar-width); min-height: 100vh; display: grid; grid-template-columns: 1fr; grid-template-areas: "top-bar" "hero" "filter" "content"; }

        /* [1. 冀遗可见度优化 & 6. 主图交互] */
        .hero-section { grid-area: hero; padding: 40px 60px; position: relative; height: 750px; display: flex; align-items: center; overflow: hidden; }
        .bg-ji-yi { position: absolute; font-size: 20vw; font-weight: 900; line-height: 1; pointer-events: none; white-space: nowrap; z-index: 0; display: flex; gap: 5vw; }
        .ji-word { color: rgba(47, 72, 66, 0.08); }
        .yi-word { color: rgba(193, 162, 104, 0.12); }
        
        .hero-card { display: flex; align-items: center; gap: 80px; z-index: 10; width: 100%; height: 100%; }
        .hero-image-box { position: relative; width: 50%; height: 90%; overflow: hidden; border: 1px solid var(--c-primary); transition: 0.5s; box-shadow: 20px 20px 0 rgba(44, 74, 71, 0.1); }
        .hero-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.8s cubic-bezier(0.165, 0.84, 0.44, 1); }
        .hero-image-box:hover .hero-img { transform: scale(1.08); }

        .hero-text h1 { font-size: 64px; margin-bottom: 20px; line-height: 1.1; }
        .hero-text p { font-size: 18px; line-height: 1.8; color: #555; max-width: 450px; margin-bottom: 40px; }
        .btn-main { padding: 18px 45px; background: var(--c-primary); color: #fff; border: none; font-weight: bold; transition: 0.3s; }
        .btn-main:hover { background: var(--c-accent); transform: translateY(-3px); }

        /* [6. 紧凑布局] */
        .filter-area { padding: 40px 60px 0; display: flex; gap: 20px; align-items: center; }
        .content-panel { padding: 30px 60px; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; perspective: 1500px; }
        
        /* [2. 物理阻尼与加载优化] */
        .product-card { background: #fff; border: 1px solid #eee; padding: 15px; position: relative; transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); opacity: 0; transform: translateY(40px); }
        .product-card.animate-in { opacity: 1; transform: translateY(0); }
        .p-image-wrap { height: 220px; background: #f9f9f9; overflow: hidden; margin-bottom: 15px; position: relative; }
        .p-img { width: 100%; height: 100%; object-fit: cover; }
        .blind-tag { position: absolute; top: 0; right: 0; background: var(--c-danger); color: #fff; font-size: 10px; padding: 4px 8px; }

        .p-price { color: var(--c-danger); font-weight: bold; font-size: 20px; font-family: var(--f-mono); margin-bottom: 5px; }
        .p-title { font-size: 16px; margin-bottom: 10px; height: 44px; overflow: hidden; }
        .btn-reveal { width: 100%; padding: 12px; background: var(--c-primary); color: #fff; border: none; font-size: 12px; font-weight: bold; transition: 0.3s; }
        .btn-reveal:hover { background: var(--c-accent); }

        .pagination { margin: 60px 0; display: flex; justify-content: center; gap: 20px; }
        .page-btn { background: none; border: 1.5px solid var(--c-primary); padding: 8px 20px; font-family: var(--f-mono); transition: 0.3s; }
        .page-btn.active { background: var(--c-primary); color: #fff; }
        .progress-indicator { position: fixed; top: 0; left: 0; width: 0%; height: 4px; background: var(--c-accent); z-index: 1001; }

        @media (max-width: 1024px) {
            .hero-card { flex-direction: column; height: auto; }
            .hero-image-box { width: 100%; height: 400px; }
            .sidebar { display: none; }
            .main-wrapper { margin-left: 0; }
        }
    </style>
</head>
<body>
    <div id="cursor-ink"></div>
    <div id="cursor-wash"></div>
    <div class="progress-indicator" id="progressIndicator"></div>

    <aside class="sidebar">
        <div class="brand-plaque">
            <div class="brand-vertical">冀遗筑梦</div>
        </div>
        <div class="time-ruler">
            <div class="dynasty-mark">SUI</div>
            <div class="dynasty-mark active">TANG</div>
            <div class="dynasty-mark">SONG</div>
            <div class="dynasty-mark">MING</div>
            <div class="dynasty-mark">QING</div>
        </div>
        <div class="social-links">
            <i class="fa fa-weixin"></i>
            <i class="fa fa-weibo"></i>
        </div>
    </aside>

    <div class="main-wrapper">
        <header class="top-bar">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="搜索非遗盲盒...">
                <button onclick="performSearch()" style="background:none; border:none;"><i class="fa fa-search"></i></button>
            </div>
            <div class="header-actions">
                <a href="cart.html" class="cart-link">
                    <i class="fa fa-shopping-basket"></i>
                    <span>惊喜袋</span>
                    <span class="cart-count-header" id="cartCount">0</span>
                </a>
                <div id="auth-section">
                    <span onclick="alert('即将上线')">登录 / 注册</span>
                </div>
            </div>
        </header>

        <section class="hero-section" id="heroRegion">
            <!-- [1. 背景大字优化] -->
            <div class="bg-ji-yi">
                <span class="ji-word">冀</span>
                <span class="yi-word">遗</span>
                <span class="ji-word">筑</span>
                <span class="yi-word">梦</span>
            </div>
            
            <div class="hero-card">
                <div class="hero-image-box">
                    <img src="https://picsum.photos/id/1043/1200/1400" alt="正定华塔" class="hero-img" id="heroImg">
                </div>
                <div class="hero-text">
                    <div style="color:var(--c-accent); font-weight:bold; letter-spacing:5px; margin-bottom:10px;">ZHENGDING SERIES</div>
                    <h1>广惠寺华塔<br>数字化神秘盒</h1>
                    <p>每一尊浮雕都是一段被数字唤醒的历史。通过AR扫描，让跨越千年的狮、象、佛像在指尖重现。限量盲盒，惊喜揭晓。</p>
                    <button class="btn-main" onclick="scrollToProducts()">开启全系列盲盒</button>
                </div>
            </div>
        </section>

        <div class="filter-area" id="product-section">
            <div style="font-size:12px; color:#999; font-family:var(--f-mono);">分类 / CATEGORY:</div>
            <button onclick="filterProducts('all')" style="background:none; border:none; border-bottom:2px solid var(--c-primary); padding:5px 10px;">全部</button>
            <button onclick="filterProducts('工艺')" style="background:none; border:none; padding:5px 10px; color:#666;">数字工艺</button>
        </div>

        <main class="content-panel">
            <div class="product-grid" id="product-container">
                <!-- 商品 JS 加载 -->
            </div>
            <div class="pagination">
                <button class="page-btn active" id="p1" onclick="changePage(1)">1</button>
                <button class="page-btn" id="p2" onclick="changePage(2)">2</button>
            </div>
        </main>
    </div>

    <script>
        const isDeployed = window.location.hostname.includes('onrender.com');
        const API_BASE = isDeployed ? 'https://jiyi-zhumeng.onrender.com' : 'http://localhost:3000';
        
        // 模拟 12 个数据用于演示 (真实环境会由 loadProducts 覆盖)
        let allProducts = Array.from({length: 12}, (_, i) => ({
            id: i + 1,
            name: "【盲盒】冀遗系列·第 " + (i + 1) + " 号神秘遗珍",
            price: 199,
            category: "工艺"
        }));

        let currentPage = 1;
        const pageSize = 6; // [3. 每页六个]

        window.onload = function() {
            loadProducts();
            initCursor();
            initHeroInteraction();
            updateCartCount();
            window.addEventListener('scroll', () => {
                const h = document.documentElement;
                document.getElementById('progressIndicator').style.width = (h.scrollTop / (h.scrollHeight - h.clientHeight)) * 100 + '%';
            });
        };

        // [2. 跳转功能]
        function scrollToProducts() {
            document.getElementById('product-section').scrollIntoView({ behavior: 'smooth' });
        }

        // [6. 主图交互]
        function initHeroInteraction() {
            const hero = document.getElementById('heroRegion');
            const img = document.getElementById('heroImg');
            hero.addEventListener('mousemove', (e) => {
                const x = (e.clientX - window.innerWidth/2) / 30;
                const y = (e.clientY - window.innerHeight/2) / 30;
                img.style.transform = `scale(1.08) translate(${x}px, ${y}px)`;
            });
            hero.addEventListener('mouseleave', () => {
                img.style.transform = `scale(1) translate(0,0)`;
            });
        }

        // [1. 墨金光标]
        function initCursor() {
            const ink = document.getElementById('cursor-ink');
            const wash = document.getElementById('cursor-wash');
            window.addEventListener('mousemove', (e) => {
                ink.style.transform = `translate(${e.clientX}px, ${e.clientY}px)`;
                wash.animate({
                    transform: `translate(${e.clientX - 17.5}px, ${e.clientY - 17.5}px)`
                }, { duration: 500, fill: "forwards" });
            });
            document.body.addEventListener('mouseover', (e) => {
                if (e.target.closest('a, button, .product-card')) wash.classList.add('ink-active');
            });
            document.body.addEventListener('mouseout', (e) => {
                if (e.target.closest('a, button, .product-card')) wash.classList.remove('ink-active');
            });
        }

        async function loadProducts() {
            try {
                const res = await fetch(`${API_BASE}/api/products`);
                const data = await res.json();
                if(data.items.length > 0) allProducts = data.items;
            } catch (e) { console.log("API 离线，使用本地预览数据"); }
            renderProducts();
        }

        function renderProducts() {
            const container = document.getElementById('product-container');
            container.innerHTML = '';
            
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const displayList = allProducts.slice(start, end);

            displayList.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="p-image-wrap">
                        <div class="blind-tag">MYSTERY BOX</div>
                        <img src="https://placehold.co/400x400/E0DED9/2F4842?text=?" class="p-img">
                    </div>
                    <div class="p-info">
                        <div class="p-price">¥${item.price}</div>
                        <h3 class="p-title">${item.name}</h3>
                        <button class="btn-reveal" onclick="addToCart()">揭晓惊喜 (加入购物车)</button>
                    </div>
                `;
                container.appendChild(card);
                
                // [2. 物理阻尼效果绑定]
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = (e.clientX - rect.left) / rect.width - 0.5;
                    const y = (e.clientY - rect.top) / rect.height - 0.5;
                    card.style.transform = `perspective(1000px) rotateY(${x*20}deg) rotateX(${-y*20}deg) scale(1.05)`;
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = `perspective(1000px) rotateY(0) rotateX(0) scale(1)`;
                });

                // [5. 动画加载]
                setTimeout(() => card.classList.add('animate-in'), index * 100);
            });
        }

        function changePage(p) {
            currentPage = p;
            document.querySelectorAll('.page-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('p'+p).classList.add('active');
            renderProducts();
            scrollToProducts();
        }

        function addToCart() {
            let count = parseInt(localStorage.getItem('cartCount') || 0) + 1;
            localStorage.setItem('cartCount', count);
            updateCartCount();
            alert("已将神秘盲盒放入惊喜袋！");
        }

        function updateCartCount() {
            document.getElementById('cartCount').textContent = localStorage.getItem('cartCount') || 0;
        }

        function performSearch() {
            const q = document.getElementById('search-input').value;
            alert("正在全网寻宝: " + q);
        }
    </script>
</body>
</html>
