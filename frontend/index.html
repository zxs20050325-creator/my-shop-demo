<!DOCTYPE html>
<html lang="zh-CN">
<!--
    ============================================================================= 
    项目名称：冀遗筑梦 - 数字化非遗盲盒平台 (SUPREME V8.2 - VISION FIXED)
    
    【核心修正说明】
    1. [Hero Image] 修正主页大图显示逻辑，采用高保真华塔视觉图作为基底。
    2. [Scheme 2 - 磁性力场] TopBar 与侧边栏组件具备物理吸附交互感。
    3. [Scheme 5 - 全场景洇染] 点击品类轴触发背景颜色转场。
    4. [Integrated] 仪式感拆盒、分层视差、博古架长卷、骨架屏、API连接全保留。
    =============================================================================
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>冀遗筑梦 | 全球首个非遗盲盒平台</title>
    
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;400;700;900&family=Ma+Shan+Zheng&family=Cinzel:wght@700&family=ZCOOL+QingKe+HuangYou&display=swap" rel="stylesheet">
    <script src="common.js"></script>

    <style>
        :root {
            /* 品牌核心色 */
            --c-primary: #2F4842;    /* 青黛 */
            --c-dark: #1a2b27;       /* 深墨 */
            --c-accent: #C1A268;     /* 鎏金 */
            --c-bg: #F5F3EF;         /* 宣纸白 */
            --c-grid: #E6E2DC;       /* 默认网格线颜色 */
            --c-danger: #B22222;     /* 朱砂红 */
            
            /* 稀有度色彩 */
            --c-ssr: #FFD700; --c-sr: #C0C0C0; --c-r: #8B5A2B;
            
            /* 品类轴色差系 */
            --node-01: rgba(47, 72, 66, 0.08);
            --node-02: rgba(193, 162, 104, 0.12);
            --node-03: rgba(70, 130, 180, 0.1);
            --node-04: rgba(178, 34, 34, 0.08);

            --f-serif: 'Noto Serif SC', serif;
            --f-art: 'Ma Shan Zheng', serif; 
            --f-eng: 'Cinzel', serif;
            --f-mono: 'Courier New', monospace;
            
            --sidebar-width: 90px;
            --trans-spring: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            --trans-smooth: all 0.8s cubic-bezier(0.19, 1, 0.22, 1);
            --fast-trans: all 0.2s ease; /* 快速过渡变量 */
        }

        /* 1. 全局环境与水墨光标 */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background-color: var(--c-bg); color: var(--c-primary); 
            font-family: var(--f-serif); overflow-x: hidden; 
            cursor: none; user-select: none;
        }
        
        /* 轻量级自定义光标 - 调整位置确保与 cursor-dot 重合 */
        #custom-cursor {
            position: fixed;
            width: 12px;
            height: 12px;
            border: 2px solid var(--c-primary);
            border-radius: 50%;
            pointer-events: none;
            z-index: 10000; /* 降低z-index，确保在 cursor-dot 下方 */
            transform: translate(-50%, -50%);
            transition: transform 0.2s ease, border-color 0.2s ease;
        }
        
        #custom-cursor.hover {
            transform: translate(-50%, -50%) scale(1.2);
            border-color: var(--c-accent);
        }
        
        body::before { 
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background-image: 
                linear-gradient(var(--c-grid) 1.5px, transparent 1.5px), 
                linear-gradient(90deg, var(--c-grid) 1.5px, transparent 1.5px); 
            background-size: 60px 60px; z-index: -2; opacity: 0.5; pointer-events: none; 
            transition: background 1s ease;
        }

        #cursor-dot { 
            width: 8px; 
            height: 8px; 
            background: var(--c-primary); 
            position: fixed; 
            pointer-events: none; 
            border-radius: 50%; 
            z-index: 10001; /* 提高z-index，确保在 custom-cursor 上方 */
            transform: translate(-50%, -50%); /* 确保与 custom-cursor 完全重合 */
            transition: transform 0.1s, background-color 0.2s ease; 
            box-shadow: 0 0 10px rgba(47, 72, 66, 0.4); 
        }
        
        /* 悬停时两个光圈同时变化 */
        .hover-active #cursor-dot {
            background: var(--c-accent);
            transform: translate(-50%, -50%) scale(1.2);
        }
        
        .ink-click-node { position: fixed; pointer-events: none; border-radius: 50%; background: radial-gradient(circle, var(--c-primary) 0%, transparent 70%); z-index: 9999; transform: translate(-50%, -50%); animation: inkFade 0.8s ease-out forwards; }
        @keyframes inkFade { 0% { width: 0; height: 0; opacity: 0.8; } 100% { width: 150px; height: 150px; opacity: 0; } }

        /* [筑梦分层视差水印] */
        .watermark-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 500; font-family: var(--f-art); }
        .watermark-word { position: absolute; font-size: 32vw; line-height: 1; opacity: 0.24; transition: transform 0.2s var(--trans-smooth); }
        #wm-zhu { top: -5%; left: 2%; color: var(--c-primary); }
        #wm-meng { bottom: -2%; right: -2%; color: #A68C55; } /* 调整为稍深的金色 */

        /* 2. 侧边导航系统 */
        .sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: var(--sidebar-width); background: #fff; border-right: 1.5px solid var(--c-primary); display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: 40px 0; z-index: 4500; transition: 0.4s var(--trans-smooth); }
        .sidebar:hover { width: 140px; }
        .brand-seal { background: var(--c-primary); color: #fff; padding: 25px 12px; border-radius: 2px; box-shadow: 4px 4px 0 var(--c-accent); transition: var(--trans-spring); }
        .brand-vertical { writing-mode: vertical-rl; font-size: 20px; font-weight: 900; letter-spacing: 5px; }

        .series-axis { flex: 1; display: flex; flex-direction: column; justify-content: center; gap: 35px; width: 100%; }
        .series-node { display: flex; align-items: center; justify-content: center; gap: 12px; opacity: 0.5; transition: 0.4s; cursor: pointer; padding: 15px 10px; border-left: 3px solid transparent; }
        .series-node[data-series="01"]:hover, .series-node[data-series="01"].active { background: var(--node-01); color: var(--c-primary); border-left-color: var(--c-primary); opacity: 1; }
        .series-node[data-series="02"]:hover, .series-node[data-series="02"].active { background: var(--node-02); color: var(--c-accent); border-left-color: var(--c-accent); opacity: 1; }
        .series-node[data-series="03"]:hover, .series-node[data-series="03"].active { background: var(--node-03); color: steelblue; border-left-color: steelblue; opacity: 1; }
        .series-node[data-series="04"]:hover, .series-node[data-series="04"].active { background: var(--node-04); color: var(--c-danger); border-left-color: var(--c-danger); opacity: 1; }

        .node-num { font-family: var(--f-mono); font-weight: 900; font-size: 14px; }
        .node-text { font-size: 11px; font-weight: bold; display: none; white-space: nowrap; }
        .sidebar:hover .node-text { display: block; animation: slideIn 0.4s; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }

        /* 3. 顶部导航与搜索 */
        .main-content { margin-left: var(--sidebar-width); position: relative; z-index: 100; }
        .top-bar { position: sticky; top: 0; height: 85px; padding: 0 60px; display: flex; justify-content: flex-end; align-items: center; gap: 40px; z-index: 4200; background: rgba(245, 243, 239, 0.7); backdrop-filter: blur(15px); border-bottom: 1px solid rgba(47, 72, 66, 0.05); transition: 0.3s; }
        
        /* 统一顶部功能栏样式 - 全部使用相同的按钮样式 */
        .top-nav-item {
            display: flex; align-items: center; gap: 12px; padding: 10px 25px; 
            background: transparent; color: var(--c-primary); border-radius: 40px; 
            transition: all 0.2s ease; font-family: var(--f-eng); font-size: 12px; 
            border: 2px solid var(--c-primary); cursor: pointer;
            position: relative;
        }
        
        .top-nav-item:hover {
            color: var(--c-accent);
            border-color: var(--c-accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(193, 162, 104, 0.2);
        }
        
        /* 搜索框特殊处理 - 保持输入功能 */
        .search-engine {
            display: flex; align-items: center; gap: 12px; padding: 10px 25px; 
            background: transparent; border-radius: 40px; 
            transition: all 0.2s ease; font-family: var(--f-eng); font-size: 12px; 
            border: 2px solid var(--c-primary); cursor: text;
            position: relative;
        }
        
        .search-engine input {
            background: none; border: none; outline: none; width: 120px; 
            font-family: var(--f-eng); font-size: 12px; color: var(--c-primary);
            padding: 0;
        }
        
        .search-engine input::placeholder {
            color: rgba(47, 72, 66, 0.6);
            font-family: var(--f-eng);
        }
        
        .search-engine:hover {
            color: var(--c-accent);
            border-color: var(--c-accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(193, 162, 104, 0.2);
        }

        .cart-trigger { 
            display: flex; align-items: center; gap: 12px; padding: 10px 25px; 
            background: transparent; color: var(--c-primary); border-radius: 40px; 
            transition: all 0.2s ease; font-family: var(--f-eng); font-size: 12px; 
            border: 2px solid var(--c-primary); cursor: pointer;
            position: relative;
        }
        
        .auth-btn { 
            display: flex; align-items: center; gap: 12px; padding: 10px 25px; 
            background: transparent; color: var(--c-primary); border-radius: 40px; 
            transition: all 0.2s ease; font-family: var(--f-eng); font-size: 12px; 
            border: 2px solid var(--c-primary); cursor: pointer;
            position: relative;
        }

        #cartBadge { background: var(--c-danger); color: #fff; width: 18px; height: 18px; border-radius: 50%; font-size: 10px; font-weight: bold; position: absolute; top: -5px; right: 5px; }
        
        /* 统一悬停效果 */
        .cart-trigger:hover, .auth-btn:hover {
            color: var(--c-accent);
            border-color: var(--c-accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(193, 162, 104, 0.2);
        }
    </style>
</head>
<body>
    <div class="main-content">
        <div class="top-bar">
            <div class="search-engine">
                <i class="fa fa-search"></i>
                <input type="text" placeholder="SEARCH...">
            </div>
            <div class="cart-trigger" id="cartTrigger">
                <i class="fa fa-shopping-cart"></i>
                <span>CART</span>
                <span id="cartBadge">0</span>
            </div>
            <div class="auth-btn" id="authSection">
                SIGN IN / JOIN
            </div>
        </div>
    </div>

    <!-- 注册登录模态框 -->
    <div class="auth-modal" id="authModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(47,72,66,0.6); backdrop-filter: blur(10px); z-index: 8000; justify-content: center; align-items: center;">
        <div class="modal-box" style="background: var(--c-bg); padding: 60px; width: 450px; border: 3px solid var(--c-primary); box-shadow: 30px 30px 0 var(--c-accent); animation: modalPop 0.5s var(--trans-spring); position: relative;">
            <h3 style="font-family: var(--f-eng); font-size: 24px; margin-bottom: 30px; text-align: center;" id="authModalTitle">用户登录</h3>
            <div id="authError" style="color: var(--c-danger); font-family: var(--f-mono); font-size: 12px; text-align: center; min-height: 20px; margin-bottom: 15px; transition: opacity 0.2s ease;"></div>
            
            <input type="text" id="authUsername" class="ink-field" placeholder="用户名" style="width: 100%; padding: 15px; border: none; border-bottom: 2px solid var(--c-primary); background: transparent; font-size: 18px; margin-bottom: 30px; outline: none;">
            <input type="password" id="authPassword" class="ink-field" placeholder="密码" style="width: 100%; padding: 15px; border: none; border-bottom: 2px solid var(--c-primary); background: transparent; font-size: 18px; margin-bottom: 30px; outline: none;">
            
            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <button id="loginBtn" class="top-nav-item" style="flex: 1; justify-content: center; padding: 12px;">登录</button>
                <button id="registerBtn" class="top-nav-item" style="flex: 1; justify-content: center; padding: 12px;">注册</button>
            </div>
            
            <button id="switchModeBtn" class="top-nav-item" style="width: 100%; justify-content: center; padding: 12px;">切换到注册</button>
        </div>
    </div>

    <script>
        // 认证模态框功能
        document.addEventListener('DOMContentLoaded', function() {
            const authSection = document.getElementById('authSection');
            const authModal = document.getElementById('authModal');
            const authModalTitle = document.getElementById('authModalTitle');
            const switchModeBtn = document.getElementById('switchModeBtn');
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const authError = document.getElementById('authError');
            const authUsername = document.getElementById('authUsername');
            const authPassword = document.getElementById('authPassword');

            let isRegisterMode = false;

            // 切换模式
            function toggleAuthMode() {
                isRegisterMode = !isRegisterMode;
                if (isRegisterMode) {
                    authModalTitle.textContent = '用户注册';
                    switchModeBtn.textContent = '切换到登录';
                    loginBtn.style.display = 'none';
                    registerBtn.style.display = 'flex';
                } else {
                    authModalTitle.textContent = '用户登录';
                    switchModeBtn.textContent = '切换到注册';
                    loginBtn.style.display = 'flex';
                    registerBtn.style.display = 'none';
                }
                authError.textContent = '';
                authUsername.value = '';
                authPassword.value = '';
            }

            // 登录功能
            async function handleLogin() {
                const username = authUsername.value.trim();
                const password = authPassword.value;
                
                if (!username || !password) {
                    authError.textContent = '请输入用户名和密码';
                    return;
                }

                try {
                    const apiBase = getApiBase();
                    
                    const response = await fetch(`${apiBase}/api/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        localStorage.setItem('jiyi_user', username);
                        showToast('登录成功！');
                        authModal.style.display = 'none';
                        setTimeout(() => {
                            syncSession();
                            updateCartCount();
                        }, 1000);
                    } else {
                        authError.textContent = result.message || '登录失败';
                    }
                } catch (error) {
                    console.error('登录请求失败:', error);
                    authError.textContent = '网络错误，请稍后重试';
                }
            }

            // 注册功能
            async function handleRegister() {
                const username = authUsername.value.trim();
                const password = authPassword.value;
                
                if (!username || !password) {
                    authError.textContent = '请输入用户名和密码';
                    return;
                }
                
                if (password.length < 6) {
                    authError.textContent = '密码长度至少6位';
                    return;
                }

                try {
                    const apiBase = getApiBase();
                    
                    const response = await fetch(`${apiBase}/api/register`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        localStorage.setItem('jiyi_user', username);
                        showToast('注册成功！');
                        authModal.style.display = 'none';
                        setTimeout(() => {
                            syncSession();
                            updateCartCount();
                        }, 1000);
                    } else {
                        authError.textContent = result.message || '注册失败';
                    }
                } catch (error) {
                    console.error('注册请求失败:', error);
                    authError.textContent = '网络错误，请稍后重试';
                }
            }

            // 事件绑定
            if (authSection) {
                authSection.onclick = () => {
                    const currentUser = localStorage.getItem('jiyi_user');
                    if (currentUser) {
                        if (confirm('确定要登出吗？')) {
                            localStorage.removeItem('jiyi_user');
                            localStorage.removeItem('jiyi_cart');
                            showToast('已登出');
                            setTimeout(() => {
                                syncSession();
                                updateCartCount();
                            }, 1000);
                        }
                    } else {
                        authModal.style.display = 'flex';
                        toggleAuthMode(); // 默认显示登录
                    }
                };
            }

            if (switchModeBtn) {
                switchModeBtn.onclick = toggleAuthMode;
            }

            if (loginBtn) {
                loginBtn.onclick = handleLogin;
            }

            if (registerBtn) {
                registerBtn.onclick = handleRegister;
            }

            // 点击模态框外部关闭
            authModal.onclick = (e) => {
                if (e.target === authModal) {
                    authModal.style.display = 'none';
                }
            };

            // ESC键关闭
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && authModal.style.display === 'flex') {
                    authModal.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
