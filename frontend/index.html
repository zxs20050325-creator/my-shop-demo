<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>冀遗筑梦————云端商城</title>
    <style>
        /* ========================================
           全局样式重置与基础设置
           ======================================== */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }

        /* 新中式极简字体方案 */
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #F9F6F0; /* 4.1 页面背景：统一设为米白色 */
            color: #333333; /* 墨色文字 */
            padding-top: 80px; 
            line-height: 1.6; 
        }

        /* ========================================
           导航栏 - 宣纸纹理+浅木色边框
           ======================================== */
        .navbar {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%;
            background: linear-gradient(to bottom, rgba(249, 246, 240, 0.95), rgba(249, 246, 240, 0.85)); /* 4.1 页面背景同步 */
            backdrop-filter: blur(10px); /* 磨砂玻璃效果 */
            color: #333333; 
            padding: 16px 40px;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            z-index: 1000;
            border-bottom: 1px solid #eaeaea; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03); 
        }

        .logo {
            font-family: 'Noto Serif SC', serif;
            font-size: 24px; 
            font-weight: 700; 
            color: #333333;
            letter-spacing: 1px;
        }

        .nav-links a { 
            color: #333333; 
            text-decoration: none; 
            margin-left: 30px; 
            font-weight: 400;
            letter-spacing: 1px; 
            transition: opacity 0.2s ease;
        }
        .nav-links a:hover { 
            opacity: 0.7; 
            color: #5a5a5a; 
        }
        
        /* 4.5 顶部图标样式 */
        .nav-links img {
            width: 24px;
            height: 24px;
            transition: transform 0.3s ease;
        }
        
        /* 3.3 顶部图标：hover放大1.05倍效果 */
        .nav-links a:hover img {
            transform: scale(1.05); /* 4.5 顶部图标：hover 放大 1.05 倍效果 */
        }

        /* 搜索框极简化 - 只保留底边框 */
        .search-container {
            display: flex;
            align-items: center;
            margin: 0 20px;
            flex: 1;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 10px 16px;
            border: 1px solid #e0e0e0;
            outline: none;
            font-family: inherit;
            font-size: 14px;
            background: white;
            transition: border-color 0.2s ease;
            color: #333333;
            border-radius: 4px;
        }

        .search-input:focus {
            border-color: #8B4513; 
        }

        /* 2.2 按钮（搜索）：默认背景色#8B4513，文字色#fff，圆角4px */
        .search-btn {
            margin-left: 8px;
            padding: 8px 16px; /* 4.4 按钮样式：内边距 8px 16px */
            background: #8B4513; /* 4.4 按钮样式：背景色 #8B4513 */
            color: white; /* 4.4 按钮样式：文字色 #fff */
            border: none;
            border-radius: 4px; /* 4.4 按钮样式：圆角 4px */
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s ease; /* 4.4 按钮样式：过渡效果 */
        }

        /* 2.2 按钮（搜索）：hover背景色变为#6D3311 */
        .search-btn:hover {
            background: #6D3311; /* 4.4 按钮样式：悬停态背景色 */
        }

        /* ========================================
           主容器布局 - Flexbox + Grid混合布局
           ======================================== */
        .container { 
            max-width: 1200px; /* 2.1 整体容器：宽度 1200px 居中 */
            margin: 0 auto; /* 2.1 整体容器：宽度 1200px 居中 */
            padding: 0 20px;
        }

        /* 页面标题区域优化 */
        .header-section {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 30px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .page-title h2 {
            font-size: 32px;
            font-weight: 700;
            color: #333333;
            margin-bottom: 8px;
            font-family: 'Noto Serif SC', serif;
            letter-spacing: 2px;
        }

        .page-title p {
            font-size: 16px;
            color: #666666;
            font-style: italic;
        }

        /* 主内容区布局调整 */
        .main-content {
            display: flex; /* Flex布局 */
            gap: 20px; /* 筛选栏与内容区间距 */
            padding: 20px 0;
        }

        /* 左侧分类筛选改进 */
        .filter-container {
            display: grid; /* 使用Grid布局替代Flex，实现更整洁的排列 */
            grid-template-columns: 1fr; /* 单列布局 */
            gap: 12px; /* 统一按钮间距 */
            padding: 20px; /* 增加内边距 */
            background: #ffffff; /* 白色背景，提升对比度 */
            border-radius: 8px; /* 圆角设计 */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); /* 轻微阴影 */
            margin-right: 20px; /* 与内容区的间距 */
            min-width: 120px;
        }

        .filter-btn {
            padding: 12px 16px; /* 增加按钮内边距 */
            border: 1px solid #e0e0e0; /* 边框颜色 */
            background: #f9f9f9; /* 浅灰背景 */
            color: #333333; /* 文字颜色 */
            border-radius: 6px; /* 圆角设计 */
            cursor: pointer;
            font-size: 14px; /* 合适的字体大小 */
            font-weight: 500; /* 字体粗细 */
            transition: all 0.3s ease; /* 过渡效果 */
        }

        .filter-btn:hover {
            background: #f0f0f0; /* 悬停背景色 */
            transform: translateY(-1px); /* 轻微上浮效果 */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* 增强阴影 */
        }

        .filter-btn.active {
            background: #8B4513; /* 活跃状态背景色 */
            color: white; /* 活跃状态文字色 */
            border-color: #8B4513; /* 活跃状态边框色 */
        }

        .content-area {
            flex: 1; /* 内容区占满剩余空间 */
            background: #ffffff; /* 白色背景 */
            border-radius: 8px; /* 圆角设计 */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); /* 轻微阴影 */
            padding: 20px; /* 内边距 */
        }

        /* 商品卡片布局优化 */
        .product-grid {
            display: grid; /* 使用Grid布局 */
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* 响应式列数 */
            gap: 24px; /* 统一卡片间距 */
            padding: 20px 0;
        }

        .product-card {
            background: #ffffff; /* 白色背景 */
            border-radius: 12px; /* 圆角设计 */
            overflow: hidden; /* 隐藏溢出内容 */
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06); /* 阴影效果 */
            transition: all 0.3s ease; /* 过渡效果 */
            display: flex; /* Flex布局 */
            flex-direction: column; /* 垂直排列 */
            position: relative;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-4px); /* 悬停上浮效果 */
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12); /* 增强阴影 */
        }

        .product-card img {
            width: 100%; /* 图片宽度100% */
            height: 220px; /* 固定高度 */
            object-fit: cover; /* 保持比例填充 */
        }

        .product-info {
            padding: 16px; /* 内边距 */
            flex-grow: 1; /* 填充剩余空间 */
            display: flex; /* Flex布局 */
            flex-direction: column; /* 垂直排列 */
        }

        .product-title {
            font-size: 16px; /* 标题字体大小 */
            font-weight: 600; /* 标题字体粗细 */
            color: #333333; /* 标题颜色 */
            margin-bottom: 8px; /* 标题与价格间距 */
            line-height: 1.4; /* 行高 */
        }

        .product-price {
            font-size: 20px; /* 价格字体大小 */
            font-weight: 700; /* 价格字体粗细 */
            color: #8B4513; /* 价格颜色 */
            margin-bottom: 12px; /* 价格与按钮间距 */
        }

        /* 收藏按钮样式 */
        .favorite-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 36px;
            height: 36px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            color: #cccccc;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .favorite-btn:hover {
            background: white;
            transform: scale(1.1);
            color: #ff4757;
        }

        .favorite-btn.active {
            color: #ff4757;
        }

        /* 用户评价样式 */
        .product-reviews {
            padding: 12px 0;
            margin-bottom: 12px;
        }

        .review-stars {
            color: #ffd700;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .review-count {
            font-size: 12px;
            color: #666666;
        }

        .add-to-cart-btn {
            padding: 10px 16px; /* 按钮内边距 */
            background: #8B4513; /* 按钮背景色 */
            color: white; /* 按钮文字色 */
            border: none; /* 无边框 */
            border-radius: 6px; /* 圆角设计 */
            cursor: pointer; /* 指针样式 */
            font-size: 14px; /* 按钮文字大小 */
            font-weight: 500; /* 按钮文字粗细 */
            transition: all 0.2s ease; /* 过渡效果 */
        }

        .add-to-cart-btn:hover {
            background: #6D3311; /* 悬停背景色 */
            transform: translateY(-1px); /* 轻微上浮 */
        }

        /* 通知样式 */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            font-size: 14px;
            animation: slideIn 0.3s ease;
        }

        .notification-success {
            background: #2ed573;
            color: white;
        }

        .notification-error {
            background: #ff6b81;
            color: white;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* 分页样式 */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            gap: 16px;
        }

        .page-btn {
            padding: 8px 16px;
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            color: #333333;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .page-btn:hover:not(:disabled) {
            background: #f0f0f0;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-info {
            font-size: 14px;
            color: #666666;
        }

        /* 无结果提示 */
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #666666;
        }

        /* 搜索结果提示 */
        .search-results {
            padding: 16px;
            background: #f9f9f9;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                padding: 12px 20px;
            }

            .search-container {
                margin: 12px 0;
                max-width: 100%;
            }

            .nav-links {
                margin-top: 12px;
            }

            .main-content {
                flex-direction: column;
            }

            .filter-container {
                margin-right: 0;
                margin-bottom: 20px;
                grid-template-columns: repeat(3, 1fr);
            }

            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">冀遗筑梦</div>
        
        <!-- 搜索框 -->
        <div class="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="搜索商品..." onkeypress="handleSearchKeypress(event)" oninput="showSearchHint()">
            <button class="search-btn" onclick="performSearch()">搜索</button>
        </div>
        
        <div class="nav-links" id="auth-section">
            <!-- JS填充 -->
        </div>
    </nav>

    <div class="container">
        <!-- 标题区域 -->
        <div class="header-section">
            <div class="page-title">
                <h2>传承非遗 · 筑梦河北</h2>
                <p>精选燕赵大地文化瑰宝</p>
            </div>
        </div>

        <!-- 主体内容：分类筛选 + 商品展示 -->
        <div class="main-content">
            <!-- 左侧分类筛选 -->
            <div class="filter-container" id="filter-container">
                <button class="filter-btn active" data-category="all">全部</button>
                <button class="filter-btn" data-category="工艺品">工艺</button>
                <button class="filter-btn" data-category="剪纸">剪纸</button>
                <button class="filter-btn" data-category="雕塑">雕塑</button>
                <button class="filter-btn" data-category="陶瓷">陶瓷</button>
                <button class="filter-btn" data-category="雕刻">雕刻</button>
                <button class="filter-btn" data-category="文房四宝">文房</button>
                <button class="filter-btn" data-category="年画">年画</button>
                <button class="filter-btn" data-category="金银器">金银</button>
                <button class="filter-btn" data-category="内画">内画</button>
                <button class="filter-btn" data-category="泥塑">泥塑</button>
                <button class="filter-btn" data-category="乐器">乐器</button>
            </div>

            <!-- 右侧内容区域 -->
            <div class="content-area">
                <!-- 搜索结果提示 -->
                <div class="search-results" id="search-results"></div>

                <div class="product-grid" id="product-list"></div>

                <!-- 无结果提示 -->
                <div class="no-results" id="no-results" style="display: none;">
                    没有找到相关商品，请尝试其他关键词
                </div>

                <div class="pagination" id="pagination">
                    <button class="page-btn" id="prev-btn" onclick="changePage(-1)">上一页</button>
                    <span class="page-info" id="page-info">第 1 页</span>
                    <button class="page-btn" id="next-btn" onclick="changePage(1)">下一页</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 设置API基础URL，以便在部署时调整
        // 修复：不再使用 Node.js 特有的 process.env 对象
        const isDeployed = window.location.hostname.includes('onrender.com');
        // 修改为实际的后端服务地址
        const API_BASE = isDeployed ? 'https://jiyi-zhumeng.onrender.com' : 'http://localhost:3000';
        
        // 全局变量声明
        let currentPage = 1;
        let productsCache = []; 
        let allProducts = []; // 存储所有商品用于搜索
        let isSearchMode = false; // 搜索模式标志
        let currentSearchTerm = ''; // 当前搜索关键词
        let filteredProducts = []; // 分类筛选后的商品
        let currentCategory = 'all'; // 当前分类
        let filteredSearchResults = []; // 搜索结果缓存
        
        // 初始化函数
        window.onload = function() {
            checkLoginStatus();
            loadAllProducts(); // 加载所有商品用于搜索
            trackUserAction('访问首页', '浏览商品列表');
            
            // 添加事件监听器到筛选按钮
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // 移除所有按钮的活跃状态
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    // 添加当前按钮的活跃状态
                    this.classList.add('active');
                    
                    // 获取当前分类
                    currentCategory = this.dataset.category;
                    
                    // 重置搜索模式
                    isSearchMode = false;
                    currentSearchTerm = '';
                    document.getElementById('search-results').innerHTML = '';
                    
                    // 筛选商品
                    filterProducts(currentCategory);
                });
            });
        }
        
        // 检查登录状态
        function checkLoginStatus() {
            // 实现登录状态检查
            // 这里可以根据实际情况实现
            const authSection = document.getElementById('auth-section');
            authSection.innerHTML = `
                <a href="login.html">登录</a>
                <a href="register.html">注册</a>
                <a href="cart.html"><img src="cart-icon.png" alt="购物车"></a>
            `;
        }
        
        // 加载所有商品
        async function loadAllProducts() {
            try {
                const response = await fetch(`${API_BASE}/api/products`);
                const data = await response.json();
                allProducts = data;
                filterProducts('all');
            } catch (error) {
                console.error('加载商品失败:', error);
                // 使用模拟数据
                loadMockProducts();
            }
        }
        
        // 筛选商品
        function filterProducts(category) {
            if (category === 'all') {
                filteredProducts = allProducts;
            } else {
                filteredProducts = allProducts.filter(product => 
                    product.category === category
                );
            }
            
            // 分页处理
            const startIndex = (currentPage - 1) * 6;
            const endIndex = startIndex + 6;
            const paginatedProducts = filteredProducts.slice(startIndex, endIndex);
            
            displayProducts(paginatedProducts);
            updatePagination();
        }
        
        // 搜索功能
        function performSearch() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            if (!searchTerm) {
                // 如果搜索词为空，显示全部商品
                filterProducts('all');
                document.getElementById('search-results').innerHTML = '';
                isSearchMode = false;
                filteredSearchResults = [];
                return;
            }
            
            currentSearchTerm = searchTerm;
            isSearchMode = true;
            
            // 筛选搜索结果
            filteredSearchResults = allProducts.filter(product => 
                product.name.toLowerCase().includes(searchTerm) || 
                (product.desc && product.desc.toLowerCase().includes(searchTerm)) ||
                product.category.toLowerCase().includes(searchTerm)
            );
            
            if (filteredSearchResults.length > 0) {
                // 分页处理
                const paginatedResults = filteredSearchResults.slice(0, 6);
                displayProducts(paginatedResults);
                document.getElementById('search-results').innerHTML = `<p>找到 ${filteredSearchResults.length} 个关于 "${searchTerm}" 的结果</p>`;
                document.getElementById('no-results').style.display = 'none';
                document.getElementById('pagination').style.display = 'flex';
                
                // 设置搜索模式的分页信息
                document.getElementById('page-info').innerText = `第 1 页 / 共 ${Math.ceil(filteredSearchResults.length / 6)} 页`;
                document.getElementById('prev-btn').disabled = true;
                document.getElementById('next-btn').disabled = filteredSearchResults.length <= 6;
            } else {
                document.getElementById('product-list').innerHTML = '';
                document.getElementById('search-results').innerHTML = `<p>没有找到关于 "${searchTerm}" 的结果</p>`;
                document.getElementById('no-results').style.display = 'block';
                document.getElementById('pagination').style.display = 'none';
            }
            
            currentPage = 1;
        }
        
        // 键盘搜索
        function handleSearchKeypress(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }
        
        // 搜索提示
        function showSearchHint() {
            const input = document.getElementById('search-input');
            if (input.value.length > 0) {
                input.placeholder = '支持商品名/描述搜索...';
            } else {
                input.placeholder = '搜索商品...';
            }
        }
        
        // 显示商品函数
        function displayProducts(products) {
            const productList = document.getElementById('product-list');
            productList.innerHTML = '';
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.onclick = () => viewProductDetail(product.id);
                
                // 检查商品是否已收藏
                const isFavorite = checkIfFavorite(product.id);
                
                // 生成评价星级
                const rating = product.rating || 4.5;
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 >= 0.5;
                const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
                
                let starsHTML = '';
                for (let i = 0; i < fullStars; i++) starsHTML += '★';
                if (hasHalfStar) starsHTML += '★';
                for (let i = 0; i < emptyStars; i++) starsHTML += '☆';
                
                productCard.innerHTML = `
                    <button class="favorite-btn ${isFavorite ? 'active' : ''}" onclick="event.stopPropagation(); toggleFavorite(this, ${product.id})" style="color: ${isFavorite ? '#ff4757' : '#cccccc'}">❤</button>
                    <img src="${product.image || 'https://via.placeholder.com/300'}" alt="${product.name}">
                    <div class="product-info">
                        <h3 class="product-title">${product.name}</h3>
                        <p class="product-price">¥${product.price}</p>
                        <div class="product-reviews">
                            <div class="review-stars">${starsHTML}</div>
                            <div class="review-count">${product.reviewCount || 0}条评价</div>
                        </div>
                        <button class="add-to-cart-btn" onclick="event.stopPropagation(); addToCart(${product.id})">加入购物车</button>
                    </div>
                `;
                
                productList.appendChild(productCard);
            });
        }
        
        // 添加到购物车
        async function addToCart(productId) {
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '添加中...';
            button.disabled = true;
            
            try {
                // 实现添加到购物车功能
                // 这里可以根据实际API实现
                const response = await fetch(`${API_BASE}/api/cart/add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ productId, quantity: 1 })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // 显示成功提示
                    showNotification('已加入购物车', 'success');
                    button.textContent = '已加入!';
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.disabled = false;
                    }, 1000);
                } else {
                    button.textContent = originalText;
                    button.disabled = false;
                    showNotification('添加失败: ' + (data.message || '未知错误'), 'error');
                }
            } catch(e) {
                button.textContent = originalText;
                button.disabled = false;
                showNotification('网络错误，请稍后重试', 'error');
            }
        }
        
        // 查看商品详情
        function viewProductDetail(id) {
            window.location.href = `product-detail.html?id=${id}`;
        }
        
        // 翻页处理
        function changePage(step) {
            // 添加防抖
            if (document.getElementById('prev-btn').disabled && step < 0) return;
            if (document.getElementById('next-btn').disabled && step > 0) return;

            if (isSearchMode) {
                // 搜索模式下的翻页
                const newPage = currentPage + step;
                const startIndex = (newPage - 1) * 6;
                const endIndex = startIndex + 6;
                const pageProducts = filteredSearchResults.slice(startIndex, endIndex);
                
                if (pageProducts.length > 0) {
                    displayProducts(pageProducts);
                    document.getElementById('page-info').innerText = `第 ${newPage} 页 / 共 ${Math.ceil(filteredSearchResults.length / 6)} 页`;
                    document.getElementById('prev-btn').disabled = newPage <= 1;
                    document.getElementById('next-btn').disabled = newPage >= Math.ceil(filteredSearchResults.length / 6);
                    currentPage = newPage;
                }
            } else if (currentCategory !== 'all') {
                // 分类筛选下的翻页
                const newPage = currentPage + step;
                const startIndex = (newPage - 1) * 6;
                const endIndex = startIndex + 6;
                const pageProducts = filteredProducts.slice(startIndex, endIndex);
                
                if (pageProducts.length > 0) {
                    displayProducts(pageProducts);
                    document.getElementById('page-info').innerText = `第 ${newPage} 页 / 共 ${Math.ceil(filteredProducts.length / 6)} 页`;
                    document.getElementById('prev-btn').disabled = newPage <= 1;
                    document.getElementById('next-btn').disabled = newPage >= Math.ceil(filteredProducts.length / 6);
                    currentPage = newPage;
                }
            }
        }
        
        // 更新分页信息
        function updatePagination() {
            const totalPages = Math.ceil(filteredProducts.length / 6);
            document.getElementById('page-info').innerText = `第 ${currentPage} 页 / 共 ${totalPages} 页`;
            document.getElementById('prev-btn').disabled = currentPage <= 1;
            document.getElementById('next-btn').disabled = currentPage >= totalPages;
        }
        
        // 检查商品是否已收藏
        function checkIfFavorite(productId) {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            return favorites.includes(productId);
        }
        
        // 切换收藏状态
        function toggleFavorite(button, productId) {
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            if (button.classList.contains('active')) {
                // 取消收藏
                favorites = favorites.filter(id => id !== productId);
                button.classList.remove('active');
                button.style.color = '#cccccc';
            } else {
                // 添加收藏
                favorites.push(productId);
                button.classList.add('active');
                button.style.color = '#ff4757';
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
            
            // 显示提示信息
            showNotification(button.classList.contains('active') ? '已添加到收藏' : '已取消收藏', 'success');
        }
        
        // 显示通知
        function showNotification(message, type = 'success') {
            // 创建通知元素
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            
            // 添加到页面
            document.body.appendChild(notification);
            
            // 3秒后移除
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // 用户行为跟踪
        function trackUserAction(action, product) {
            try {
                const user = localStorage.getItem('currentUser');
                fetch(`${API_BASE}/api/track`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: user, action, product })
                }).catch(() => {}); // 忽略错误
            } catch(e) {
                console.warn('无法访问localStorage或网络请求失败');
            }
        }
        
        // 加载模拟数据
        function loadMockProducts() {
            allProducts = [
                {
                    id: 1,
                    name: "【非遗国礼】蔚县剪纸-百鸟朝凤",
                    price: 299,
                    desc: "传承千年技艺，纯手工制作，精美绝伦的百鸟朝凤图案",
                    category: "剪纸",
                    image: "https://via.placeholder.com/300",
                    rating: 4.8,
                    reviewCount: 56
                },
                {
                    id: 2,
                    name: "【镇宅神兽】沧州铁狮-铸铁摆件",
                    price: 399,
                    desc: "依照沧州铁狮原比例缩小制作，纯铸铁打造，工艺精湛",
                    category: "雕塑",
                    image: "https://via.placeholder.com/300",
                    rating: 4.6,
                    reviewCount: 32
                },
                {
                    id: 3,
                    name: "【文房至宝】易水古砚·雕龙画凤",
                    price: 688,
                    desc: "南有端砚，北有易水。石质细腻，发墨如油，文人雅士首选",
                    category: "文房四宝",
                    image: "https://via.placeholder.com/300",
                    rating: 4.9,
                    reviewCount: 18
                },
                {
                    id: 4,
                    name: "【新春纳福】武强年画·连年有余",
                    price: 88,
                    desc: "中国木版年画之乡，色彩浓烈，线条粗犷，不仅是画，更是福气",
                    category: "年画",
                    image: "https://via.placeholder.com/300",
                    rating: 4.7,
                    reviewCount: 44
                },
                {
                    id: 5,
                    name: "【皇家工艺】花丝镶嵌·鎏金首饰盒",
                    price: 1299,
                    desc: "燕京八绝之一，细如发丝，堆垒编织，尽显宫廷奢华技艺",
                    category: "金银器",
                    image: "https://via.placeholder.com/300",
                    rating: 4.5,
                    reviewCount: 27
                },
                {
                    id: 6,
                    name: "【掌中乾坤】衡水内画·水晶鼻烟壶",
                    price: 568,
                    desc: "鬼斧神工，寸幅之地具千里之势，集诗书画印于一壶",
                    category: "内画",
                    image: "https://via.placeholder.com/300",
                    rating: 4.9,
                    reviewCount: 38
                },
                {
                    id: 7,
                    name: "【民间艺术】玉田泥塑·萌趣生肖",
                    price: 68,
                    desc: "乡土气息浓郁，造型夸张可爱，唤醒儿时的快乐记忆",
                    category: "泥塑",
                    image: "https://via.placeholder.com/300",
                    rating: 4.6,
                    reviewCount: 52
                },
                {
                    id: 8,
                    name: "【民间绝响】抚宁吹歌·乐器模型",
                    price: 328,
                    desc: "唢呐一响，黄金万两。非遗吹歌文化，传承民族之音",
                    category: "乐器",
                    image: "https://via.placeholder.com/300",
                    rating: 4.4,
                    reviewCount: 23
                }
            ];
            filterProducts('all');
        }
    </script>
</body>
</html>
