// 公共函数库

// 设置API基础URL，以便在部署时调整
const isDeployed = window.location.hostname.includes('onrender.com');
const API_BASE = isDeployed ? 'https://jiyi-zhumeng.onrender.com' : 'http://localhost:3000';

// 同步用户会话状态
function syncSession() {
    const currentUser = localStorage.getItem('jiyi_user');
    const authSection = document.getElementById('authSection');
    if(currentUser) {
        authSection.innerHTML = `${currentUser} / SIGN OUT`;
        authSection.onclick = () => {
            localStorage.clear(); 
            location.reload();
        };
    } else {
        // 在注册页面，显示登录链接
        authSection.innerHTML = "";
    }
}

// 滚动处理
function setupScrollHandler() {
    const topBar = document.getElementById('topBar');
    window.addEventListener('scroll', () => {
        if (window.pageYOffset > 50) {
            topBar.classList.add('scrolled');
        } else {
            topBar.classList.remove('scrolled');
        }
    });
}

// 更新购物车数量显示
function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const count = cart.length;
    document.getElementById('cartBadge').textContent = count;
    document.getElementById('floatingCartCount').textContent = count;
}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户注册 - 冀遗筑梦</title>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        /* 自定义光标 */
        body {
            cursor: none; /* 隐藏默认光标 */
        }
        
        .custom-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            border: 1px solid var(--c-primary);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            transform: translate(-50%, -50%);
            transition: transform 0.1s ease, width 0.3s ease, height 0.3s ease;
            mix-blend-mode: difference;
        }
        
        .custom-cursor-dot {
            position: fixed;
            width: 6px;
            height: 6px;
            background-color: var(--c-primary);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            transform: translate(-50%, -50%);
            transition: transform 0.1s ease, width 0.3s ease, height 0.3s ease;
        }
        
        a:hover ~ .custom-cursor,
        button:hover ~ .custom-cursor {
            width: 40px;
            height: 40px;
        }
        
        a:hover ~ .custom-cursor-dot,
        button:hover ~ .custom-cursor-dot {
            width: 12px;
            height: 12px;
        }
    </style>
    
    <!-- 引入公共CSS和JS -->
    <link rel="stylesheet" href="./styles.css">
    <script src="./common.js"></script>

    <style>
        /* 注册页面特定样式 */
        .register-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 40px;
            background: white;
            border: 1px solid var(--c-primary);
            border-radius: 4px;
        }
        
        .register-form input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid var(--c-grid);
            font-family: var(--f-serif);
        }
        
        .register-btn {
            width: 100%;
            padding: 12px;
            background: var(--c-primary);
            color: white;
            border: none;
            font-family: var(--f-mono);
            letter-spacing: 2px;
        }
        
        .register-btn:hover {
            background: var(--c-accent);
        }
        
        /* 轻量级自定义光标 */
        #custom-cursor {
            position: fixed;
            width: 12px;
            height: 12px;
            border: 2px solid var(--c-primary, #2F4842);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            transform: translate(-50%, -50%);
            transition: transform 0.2s ease, border-color 0.2s ease;
        }
        
        #custom-cursor.hover {
            transform: translate(-50%, -50%) scale(1.2);
            border-color: var(--c-accent, #C1A268);
        }
        
        /* 隐藏侧边栏 - 符合特定页面非必要元素隐藏规范 */
        .sidebar {
            display: none;
        }
    </style>
</head>
<body>
    <div class="floating-cart" onclick="window.location.href='cart.html'">
        <i class="fa fa-shopping-cart"></i>
        <div class="cart-count" id="floatingCartCount">0</div>
    </div>
    
    <!-- 侧边栏已隐藏，符合规范要求 -->

    <div class="main-wrapper">
        <header class="top-bar" id="topBar">
            <div class="search-engine">
                <i class="fa fa-search"></i>
                <input type="text" placeholder="SEARCH ARCHIVE..." id="searchInput">
            </div>

            <div class="cart-trigger" onclick="window.location.href='cart.html'">
                <i class="fa fa-shopping-bag"></i>
                <span>BAG</span>
                <div id="cartBadge">0</div>
            </div>

            <div class="auth-btn" id="authSection">
                <!-- JS填充 -->
            </div>
        </header>
        
        <section style="grid-area: hero; padding: 40px 60px;">
            <h1 style="font-size: 42px; margin-bottom: 10px;">用户注册</h1>
            <div style="font-family: var(--f-mono); color: var(--c-accent); font-size: 14px; margin-bottom: 20px;">USER REGISTRATION</div>
        </section>

        <main class="register-container">
            <a href="index.html" class="back-link">← 返回首页</a>
            
            <form class="register-form" onsubmit="register(event)">
                <h2 class="form-title">创建账户</h2>
                
                <div class="form-group">
                    <label class="form-label" for="reg-username">用户名</label>
                    <input type="text" id="reg-username" class="form-input" placeholder="请输入用户名" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="reg-password">密码</label>
                    <input type="password" id="reg-password" class="form-input" placeholder="请输入密码" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="confirm-password">确认密码</label>
                    <input type="password" id="confirm-password" class="form-input" placeholder="请再次输入密码" required>
                </div>
                
                <button type="submit" class="form-button">注册</button>
                
                <div class="form-footer">
                    已有账户？ <a href="login.html">立即登录</a>
                </div>
            </form>
        </main>
    </div>

    <!-- 轻量级自定义光标 -->
    <div id="custom-cursor"></div>

    <script>
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            syncSession();
            updateCartCount();
            
            // 初始化自定义光标
            const cursor = document.getElementById('custom-cursor');
            
            document.addEventListener('mousemove', function(e) {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
            });
            
            // 为链接和按钮添加悬停效果
            const hoverElements = document.querySelectorAll('a, button, .nav-link, .form-button');
            
            hoverElements.forEach(element => {
                element.addEventListener('mouseenter', () => {
                    cursor.classList.add('hover');
                });
                
                element.addEventListener('mouseleave', () => {
                    cursor.classList.remove('hover');
                });
            });
        });

        // 注册功能
        async function register(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showToast('请填写完整的用户名和密码');
                return;
            }
            
            try {
                const response = await fetch(`${getApiBase()}/api/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast('注册成功！正在跳转到登录页面...');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                } else {
                    showToast(result.message || '注册失败，请重试');
                }
            } catch (error) {
                console.error('注册错误:', error);
                showToast('网络错误，请检查连接后重试');
            }
        }
    </script>
</body>
</html>