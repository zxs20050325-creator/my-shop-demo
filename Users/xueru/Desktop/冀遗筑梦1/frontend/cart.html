    <script>
        // è®¾ç½®APIåŸºç¡€URLï¼Œä»¥ä¾¿åœ¨éƒ¨ç½²æ—¶è°ƒæ•´
        const isDeployed = window.location.hostname.includes('onrender.com');
        // ä¿®æ”¹API_BASEåœ°å€ä¸ºæ­£ç¡®çš„åç«¯åœ°å€
        const API_BASE = isDeployed ? 'https://jiyi-zhumeng.onrender.com' : 'http://localhost:3000';
        
        const user = localStorage.getItem('currentUser');
        let currentCart = [];

        window.onload = function() {
            if(!user) {
                alert('è¯·å…ˆç™»å½•');
                window.location.href = 'login.html';
                return;
            }
            document.getElementById('user-display').innerText = `å½“å‰ç”¨æˆ·: ${user}`;
            loadCart();
        }


        async function loadCart() {
            try {
                const res = await fetch(`${API_BASE}/api/cart?username=${user}`);
                currentCart = await res.json();
                renderCart();
            } catch(e) { console.error(e); }
        }

        function renderCart() {
            const listDiv = document.getElementById('cart-list');
            const checkoutBar = document.getElementById('checkout-bar');
            
            if(currentCart.length === 0) {
                listDiv.innerHTML = '<div class="empty-cart"><h3>è´­ç‰©è½¦ç©ºç©ºå¦‚ä¹Ÿ ğŸ’¨</h3><p>å»é¦–é¡µçœ‹çœ‹æœ‰æ²¡æœ‰å–œæ¬¢çš„éé—æ–‡åˆ›å§ï¼</p></div>';
                checkoutBar.style.display = 'none';
                return;
            }

            listDiv.innerHTML = '';
            let total = 0;

            currentCart.forEach((item, index) => {
                total += parseFloat(item.price);
                
                // ä¿®å¤å›¾ç‰‡è·¯å¾„å¤„ç†é€»è¾‘ - å®Œå…¨ä»åç«¯è·å–
                let imgSrc = item.img;
                
                // ç¡®ä¿å›¾ç‰‡URLæ˜¯å®Œæ•´çš„ï¼Œå¦‚æœåªæ˜¯ç›¸å¯¹è·¯å¾„åˆ™æ‹¼æ¥APIåŸºç¡€URL
                if (!imgSrc.startsWith('http') && !imgSrc.startsWith('/')) {
                    imgSrc = `${API_BASE}/${imgSrc}`;
                }
                
                listDiv.innerHTML += `
                    <div class="cart-item">
                        <img src="${imgSrc}" class="cart-img" onerror="this.src='https://placehold.co/100?text=No+Img'; console.error('Failed to load image: ' + this.src);">
                        <div class="cart-info">
                            <div class="cart-title">${item.name}</div>
                            <div class="cart-price">Â¥${item.price}</div>
                        </div>
                        <button class="btn-remove" onclick="removeItem(${index})">åˆ é™¤</button>
                    </div>
                `;
            });

            // ä¿ç•™ä¸¤ä½å°æ•°
            document.getElementById('total-price').innerText = `Â¥${total}`;
            checkoutBar.style.display = 'block';
        }
