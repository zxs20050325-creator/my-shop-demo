    <script>
        // 设置API基础URL，以便在部署时调整
        const isDeployed = window.location.hostname.includes('onrender.com');
        // 修改API_BASE地址为正确的后端地址
        const API_BASE = isDeployed ? 'https://jiyi-zhumeng.onrender.com' : 'http://localhost:3000';
        let currentProduct = null;

        window.onload = function() {
            checkLoginStatus();
            loadProductDetail();
        };


        function loadProductDetail() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            if (!productId) {
                alert('未指定商品ID');
                window.location.href = 'index.html';
                return;
            }
            
            fetch(`${API_BASE}/api/products`)
                .then(res => res.json())
                .then(data => {
                    // 遍历所有页面的商品找到匹配的
                    let product = null;
                    
                    // 先在第一页找
                    for (let page = 1; page <= data.totalPages; page++) {
                        fetch(`${API_BASE}/api/products?page=${page}`)
                            .then(res => res.json())
                            .then(pageData => {
                                product = pageData.items.find(p => p.id == productId);
                                
                                if (product) {
                                    currentProduct = product;
                                    
                                    // 修复图片路径处理逻辑 - 完全从后端获取
                                    let imgSrc = product.img;
                                    
                                    // 确保图片URL是完整的，如果只是相对路径则拼接API基础URL
                                    if (!imgSrc.startsWith('http') && !imgSrc.startsWith('/')) {
                                        imgSrc = `${API_BASE}/${imgSrc}`;
                                    }
                                    
                                    document.getElementById('product-name').textContent = product.name;
                                    document.getElementById('product-price').textContent = `¥${product.price}`;
                                    document.getElementById('product-desc').textContent = product.desc;
                                    document.getElementById('product-img').src = imgSrc;
                                    document.getElementById('product-category').textContent = product.category || '非遗商品';
                                    document.title = `${product.name} - 冀遗筑梦`;
                                }
                            });
                    }
                })
                .catch(err => console.error(err));
        }
